--
-- Cursors
--
-- These tests require track_utility to be enabled.
SET pg_stat_query_plans.track_utility = TRUE;
SELECT pg_stat_query_plans_reset() IS NOT NULL AS t;
 t 
---
 t
(1 row)

-- DECLARE
-- SELECT is normalized.
DECLARE cursor_stats_1 CURSOR WITH HOLD FOR SELECT 1;
CLOSE cursor_stats_1;
DECLARE cursor_stats_1 CURSOR WITH HOLD FOR SELECT 2;
CLOSE cursor_stats_1;
SELECT calls, rows, query FROM pg_stat_query_plans ORDER BY query COLLATE "C";
 calls | rows |                        query                         
-------+------+------------------------------------------------------
     2 |    2 | SELECT 1;
     1 |    1 | SELECT pg_stat_query_plans_reset() IS NOT NULL AS t;
(2 rows)

SELECT pg_stat_query_plans_reset() IS NOT NULL AS t;
 t 
---
 t
(1 row)

-- FETCH
BEGIN;
DECLARE cursor_stats_1 CURSOR WITH HOLD FOR SELECT 2;
DECLARE cursor_stats_2 CURSOR WITH HOLD FOR SELECT 3;
FETCH 1 IN cursor_stats_1;
 ?column? 
----------
        2
(1 row)

FETCH 1 IN cursor_stats_2;
 ?column? 
----------
        3
(1 row)

CLOSE cursor_stats_1;
CLOSE cursor_stats_2;
COMMIT;
SELECT calls, rows, query FROM pg_stat_query_plans ORDER BY query COLLATE "C";
 calls | rows |                        query                         
-------+------+------------------------------------------------------
     2 |    2 | SELECT 2;
     1 |    1 | SELECT pg_stat_query_plans_reset() IS NOT NULL AS t;
(2 rows)

SELECT pg_stat_query_plans_reset() IS NOT NULL AS t;
 t 
---
 t
(1 row)

